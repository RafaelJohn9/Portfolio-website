# Use an official Python runtime as a parent image
FROM python:3.8-slim-buster

# Set the working directory in the container to /app
WORKDIR /app

# Add current directory files to the container at /app
ADD . /app

# Install MySQL client
- 'apt-get update && apt-get install -y default-mysql-client'

# Define environment variables for MySQL
ENV MYSQL_HOST=db
ENV MYSQL_PORT=3306
ENV MYSQL_DB=PortfolioDB
ENV MYSQL_USER=user
ENV MYSQL_PASSWORD=password

# Run the command to create the database
RUN ["sh", "-c", "mysql -h ${MYSQL_HOST} -P ${MYSQL_PORT} -u ${MYSQL_USER} -p${MYSQL_PASSWORD} -e 'CREATE DATABASE IF NOT EXISTS ${MYSQL_DB};'"]

# Install any needed packages specified in requirements.txt
RUN pip install --no-cache-dir requests sqlalchemy flask flask_login flask_oauthlib

# Make port 5000 available to the world outside this container
EXPOSE 5000

# Define environment variable


# Define error log file
ENV LOG_FILE=/app/error.log

# Run api.v1.app when the container launches and redirect stderr to log file
CMD ["sh", "-c", "python3 api.v1.app 2>> ${LOG_FILE}"]
